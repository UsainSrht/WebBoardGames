<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Board Games</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        body {
            background-color: #344055;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192' viewBox='0 0 192 192'%3E%3Cpath fill='%234c526a' fill-opacity='1' d='M192 15v2a11 11 0 0 0-11 11c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H145v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11 13 13 0 1 1 .02 26 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43a6.1 6.1 0 0 0-3.03 4.87V143h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 181 164a11 11 0 0 0 11 11v2a13 13 0 0 1-13-13 12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84a6.1 6.1 0 0 0-4.87-3.03H145v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 124 181a11 11 0 0 0-11 11h-2a13 13 0 0 1 13-13c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43a6.1 6.1 0 0 0 3.03-4.87V145h-35.02a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 107 124a11 11 0 0 0-22 0c0 1.94 1.16 4.75 2.53 6.11l2.36 2.36a6.93 6.93 0 0 1 1.22 7.56l-.43.84a8.08 8.08 0 0 1-6.66 4.13H49v35.02a6.1 6.1 0 0 0 3.03 4.87l.84.43c1.58.79 4 .4 5.24-.85l2.36-2.36a12.04 12.04 0 0 1 7.51-3.11A13 13 0 0 1 81 192h-2a11 11 0 0 0-11-11c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V145H11.98a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 0 1 0 177v-2a11 11 0 0 0 11-11c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H47v-35.02a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 28 109a13 13 0 1 1 0-26c2.47 0 5.79 1.37 7.53 3.11l2.36 2.36a4.94 4.94 0 0 0 5.24.85l.84-.43A6.1 6.1 0 0 0 47 84.02V49H11.98a8.08 8.08 0 0 1-6.66-4.13l-.43-.84a6.91 6.91 0 0 1 1.22-7.56l2.36-2.36A10.06 10.06 0 0 0 11 28 11 11 0 0 0 0 17v-2a13 13 0 0 1 13 13c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84A6.1 6.1 0 0 0 11.98 47H47V11.98a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 68 11 11 11 0 0 0 79 0h2a13 13 0 0 1-13 13 12 12 0 0 1-7.53-3.11l-2.36-2.36a4.93 4.93 0 0 0-5.24-.85l-.84.43A6.1 6.1 0 0 0 49 11.98V47h35.02a8.08 8.08 0 0 1 6.66 4.13l.43.84a6.91 6.91 0 0 1-1.22 7.56l-2.36 2.36A10.06 10.06 0 0 0 85 68a11 11 0 0 0 22 0c0-1.94-1.16-4.75-2.53-6.11l-2.36-2.36a6.93 6.93 0 0 1-1.22-7.56l.43-.84a8.08 8.08 0 0 1 6.66-4.13H143V11.98a6.1 6.1 0 0 0-3.03-4.87l-.84-.43c-1.59-.8-4-.4-5.24.85l-2.36 2.36A12 12 0 0 1 124 13a13 13 0 0 1-13-13h2a11 11 0 0 0 11 11c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V47h35.02a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 179 28a13 13 0 0 1 13-13zM84.02 143a6.1 6.1 0 0 0 4.87-3.03l.43-.84c.8-1.59.4-4-.85-5.24l-2.36-2.36A12 12 0 0 1 83 124a13 13 0 1 1 26 0c0 2.47-1.37 5.79-3.11 7.53l-2.36 2.36a4.94 4.94 0 0 0-.85 5.24l.43.84a6.1 6.1 0 0 0 4.87 3.03H143v-35.02a8.08 8.08 0 0 1 4.13-6.66l.84-.43a6.91 6.91 0 0 1 7.56 1.22l2.36 2.36A10.06 10.06 0 0 0 164 107a11 11 0 0 0 0-22c-1.94 0-4.75 1.16-6.11 2.53l-2.36 2.36a6.93 6.93 0 0 1-7.56 1.22l-.84-.43a8.08 8.08 0 0 1-4.13-6.66V49h-35.02a6.1 6.1 0 0 0-4.87 3.03l-.43.84c-.79 1.58-.4 4 .85 5.24l2.36 2.36a12.04 12.04 0 0 1 3.11 7.51A13 13 0 1 1 83 68a12 12 0 0 1 3.11-7.53l2.36-2.36a4.93 4.93 0 0 0 .85-5.24l-.43-.84A6.1 6.1 0 0 0 84.02 49H49v35.02a8.08 8.08 0 0 1-4.13 6.66l-.84.43a6.91 6.91 0 0 1-7.56-1.22l-2.36-2.36A10.06 10.06 0 0 0 28 85a11 11 0 0 0 0 22c1.94 0 4.75-1.16 6.11-2.53l2.36-2.36a6.93 6.93 0 0 1 7.56-1.22l.84.43a8.08 8.08 0 0 1 4.13 6.66V143h35.02z'%3E%3C/path%3E%3C/svg%3E");
        }
    </style>
</head>
<body class="flex items-center justify-center h-screen">
    
    <!-- Game Board -->
    <div id="game-board" class="w-full h-full absolute top-0 left-0">

        <!-- <canvas id="canvas-board" class="w-full h-full"></canvas> -->

    </div>
    
    <!-- Lobby Popup -->
    <div id="lobby-popup" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-1/2 h-1/2 bg-gray-800 p-4 rounded-2xl shadow-lg transition-all duration-500 ease-in-out">
        <div>
            <h1 class="text-2xl font-bold text-center text-white mb-4">Lobby</h1>
            <div class="flex">
                <div class="relative w-1/2 pr-2 flex flex-col">
                    <h2 class="text-lg font-semibold text-white text-center mb-2">Players</h2>
                    <div class="overflow-y-auto h-64">
                        <div id="lobby-players" class="space-y-2 px-2">
                            <div class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md h-10"></div>
                            <div class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md h-10"></div>
                            <div class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md h-10"></div>
                            <div class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md h-10"></div>
                        </div>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 p-2">
                        <button id="ready-button" onclick="toggleReady(this)" class="wbg-not-ready w-full h-10 bg-blue-500 hover:bg-blue-600 rounded-md mt-2 flex items-center justify-center">
                            <span class="text-white text-lg">Ready</span>
                        </button>
                    </div>
                </div>
                <div class="border-l border-gray-700 mx-2"></div>
                <div class="w-1/2 pl-2">
                    <h2 id="games-label" class="text-lg font-semibold text-center text-white mb-2">Games</h2>
                    <div class="max-w-sm mx-auto">
                        <div class="flex-1 overflow-y-auto h-80">
                            <div id="games" class="grid grid-cols-3 gap-2 h-1/2 p-2">
                                <button id="game-rock-paper-scissors" onclick="selectGame('rock-paper-scissors')" class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md aspect-square text-center text-white overflow-hidden">
                                    <img src="./images/rock-paper-scissors.png" alt="Rock Paper Scissors" class="w-1/2 mx-auto mt-2">
                                    <span class="text-sm">Rock Paper Scissors</span>
                                </button>
                                <button id="game-dice" onclick="selectGame('dice')"  class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md aspect-square text-center text-white overflow-hidden">
                                    <img src="./images/dice.png" alt="Dice" class="w-1/2 mx-auto mt-2">
                                    <span class="text-sm">Dice</span>
                                </button>
                                <button class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md aspect-square text-center text-white"></button>
                                <button class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md aspect-square text-center text-white"></button>
                                <button class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md aspect-square text-center text-white"></button>
                                <button class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md aspect-square text-center text-white"></button>
                                <button class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md aspect-square text-center text-white"></button>
                                <button class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md aspect-square text-center text-white"></button>
                                <button class="bg-transparent border-2 border-gray-700 hover:bg-gray-600 transition-all duration-200 rounded-md aspect-square text-center text-white"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Popup -->
    <div id="settings-popup" class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center" onclick="closePopup('settings-popup', event)">
        <div class="bg-white p-6 rounded-lg shadow-lg text-black relative" onclick="event.stopPropagation();">
            <button onclick="closePopup('settings-popup')" class="absolute top-2 right-2 text-gray-600 hover:text-red-500">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                  </svg>                  
            </button>
            <h2 class="text-xl font-bold">Settings</h2>
            <label class="inline-flex items-center me-5 cursor-pointer">
                <input type="checkbox" value="" class="sr-only peer" checked>
                <div class="relative w-11 h-6 bg-gray-700 rounded-full peer peer-focus:ring-4 peer-focus:ring-green-800 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all border-gray-600 peer-checked:bg-green-600"></div>
                <span class="ms-3 text-sm font-medium text-gray-300">Setting 1</span>
            </label>
        </div>
    </div>

    <!-- drawer component -->
    <div id="player-sidebar" class="fixed top-0 right-0 z-40 h-screen p-4 overflow-y-auto transition-transform translate-x-full bg-gray-800 w-80" tabindex="-1" aria-labelledby="drawer-right-label">
        <!-- Players Section -->
        <div id="players-section" class="h-1/3 overflow-y-auto">
            <h5 id="drawer-right-label" class="inline-flex items-center mb-4 text-base font-semibold text-gray-400">Players</h5>
            <button type="button" data-drawer-hide="player-sidebar" aria-controls="player-sidebar" class="text-gray-400 bg-transparent rounded-lg text-sm w-8 h-8 absolute top-2.5 end-2.5 inline-flex items-center justify-center hover:bg-gray-600 hover:text-white">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                </svg>
                <span class="sr-only">Close menu</span>
            </button>
            <div id="players"></div>
        </div>
        
        <!-- Chat Section -->
        <div id="chat-section" class="flex flex-col h-2/3">
            <h5 id="drawer-right-label-chat" class="inline-flex items-center mb-4 text-base font-semibold text-gray-400">Chat</h5>
            <div id="message-box" class="flex-grow p-2 overflow-y-auto border border-gray-600 rounded-lg bg-gray-700"></div>
            <div class="flex items-center mt-2">
                <input id="chat-input" type="text" placeholder="Type a message..." class="flex-grow p-2 border rounded-lg border-gray-600 bg-gray-700 text-white" onkeydown="if (event.keyCode == 13) sendChatMessage()">
                <button id="send-btn" class="ml-2 p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" onclick="sendChatMessage()">Send</button>
            </div>
        </div>
    </div>
    
    <!-- UI Controls -->
    <div class="fixed top-4 right-4 space-x-4 flex">
        <!-- Nickname -->
        <span id="nickname-display" class="text-white text-2xl">Nickname</span>

        <!-- Room Code -->
        <button id="room-code-button" class="flex ml-2 p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" onclick="copyRoomCode()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" />
            </svg>
            <span id="room-code">RoomCode</span>
        </button>

        <!-- Server Status Icon -->
        <button class="text-white text-2xl" onclick="showToast(`click ${Date.now()}`)">
            <svg id="server-status-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-red-500">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z" />
            </svg>
        </button>

        <!-- Settings -->
        <button onclick="openPopup('settings-popup')" class="text-white text-2xl">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.398.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.506-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
              </svg>              
        </button>
        
        <!-- drawer init and toggle -->   
        <button class="relative text-white text-2xl" type="button" data-drawer-target="player-sidebar" data-drawer-show="player-sidebar" data-drawer-placement="right" aria-controls="player-sidebar">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
            </svg>    
            <!-- Notification Badge -->
            <span id="notification-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full">!</span>
        </button>
    </div>
    <div class="fixed top-4 left-4 spaxe-x-4 flex">
        <button id="leave-room" class="flex ml-2 p-2 text-white rounded-lg bg-transparent hover:bg-red-500 opacity-50" onclick="leaveRoomPopup()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75" />
            </svg>
            <span>Leave</span>
        </button>
    </div>

    <!-- Nickname popup -->
    <div id="nickname-popup" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 left-0 z-50 w-full h-full md:inset-0 h-modal md:h-full bg-black bg-opacity-50 flex items-center justify-center">
        <div class="relative p-4 w-full max-w-lg h-full md:h-auto">
            <div class="relative p-4 rounded-lg shadow bg-gray-800 md:p-8">
                <div class="mb-4 text-sm font-light  text-gray-400">
                    <h3 class="mb-3 text-2xl font-bold text-white">You'll need a name</h3>
                    <div id="nicknameForm" >
                        <label for="nickname" class="mb-2 text-sm font-medium sr-only text-white">Nickname</label>
                        <div class="relative">
                            <input onkeydown="if (event.keyCode == 13) checkName()" type="nickname" id="nickname" class="block w-full p-4 ps-10 text-sm border rounded-lg bg-gray-700 border-gray-600 placeholder-gray-400 text-white focus:ring-blue-500 focus:border-blue-500" placeholder="Nickname" required />
                            <button onclick="checkName()" class="text-white absolute end-2.5 bottom-2 focus:ring-4 focus:outline-none font-medium rounded-lg text-sm px-4 py-2 bg-green-600 hover:bg-green-700 focus:ring-green-800">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                                </svg>                          
                            </button>
                        </div>
                        <p id="nickname-input-reply" class="mt-2 text-sm text-red-500 hidden"><span class="font-medium"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leave Room popup -->
    <div id="leave-popup" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 left-0 z-50 w-full h-full md:inset-0 h-modal md:h-full bg-black bg-opacity-50 flex items-center justify-center">
        <div class="relative p-4 w-full max-w-lg h-full md:h-auto">
            <div class="relative p-4 rounded-lg shadow bg-gray-800 md:p-8">
                <div class="mb-4 text-sm font-light text-gray-400">
                    <h3 class="text-2xl font-bold text-center text-white mb-5">Do you want to leave?</h3>
                    <div id="leaveForm" class="flex items-center justify-between">
                        <button onclick="closeLeaveRoomPopup()" class=" text-center text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-4 py-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                            </svg>
                        </button>
                        <button onclick="leaveRoom()" class="text-center text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kick popup -->
    <div id="kick-popup" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 left-0 z-50 w-full h-full md:inset-0 h-modal md:h-full bg-black bg-opacity-50 flex items-center justify-center">
        <div class="relative p-4 w-full max-w-lg h-full md:h-auto">
            <div class="relative p-4 rounded-lg shadow bg-gray-800 md:p-8">
                <div class="mb-4 text-sm font-light text-gray-400">
                    <div id="kick-id" class="hidden"></div>
                    <h3 class="text-2xl font-bold text-center text-white mb-5">Do you want to kick <span id="kick-name"></span></h3>
                    <div id="kickForm" class="flex items-center justify-between">
                        <button onclick="closeKickPopup()" class=" text-center text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-4 py-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                            </svg>
                        </button>
                        <button onclick="kickPlayer(document.getElementById('kick-id').innerHTML)" class="text-center text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast-container" class="fixed top-0 left-0 z-50 p-4 space-y-2"></div>

    <script>
        console.log("game debug start");
        const socket = io();

        socket.onAny((eventName, ...args) => {
            console.log(eventName, "in with args: ", args);
        });

        socket.on("error", (error) => {
            console.error("Error from server:", error);
            //showToast(`Error: ${error}`);
            alert(`Error: ${error}`);
        });

        function tryJoinURLRoom() {
            let params = new URLSearchParams(window.location.search);
            let roomCode = params.get("room");
            if (params.has("room")) {
                joinRoom(roomCode);
            } else {
                //redirect to home page
                //window.location.href = "/index.html";
            }
        }

        function joinRoom(roomCode) {
            socket.emit("join-room", roomCode);
        }

        // Server connection status
        socket.on("connect", () => {
            document.getElementById("server-status-icon").classList.remove("text-red-500");
            document.getElementById("server-status-icon").classList.add("text-green-500");
        });

        socket.on("disconnect", () => {
            document.getElementById("server-status-icon").classList.remove("text-green-500");
            document.getElementById("server-status-icon").classList.add("text-red-500");
        });

        socket.on("connect-user", (userId, name, room) => {
            localStorage.setItem("userId", userId);
            document.getElementById("nickname-display").textContent = name || "Guest";
            document.getElementById("room-code").textContent = room || "?????";
            if (!room) {
                tryJoinURLRoom();
            } else {
                joinRoom(room);
                //socket.emit("request-room-data", room);
            }
        });

        let host;
        let isHost;
        let started;
        let game;
        let minPlayers;
        let maxPlayers;
        socket.on("send-room-data", (room, players, receivedHost, isStarted, selectedGame, min, max, gameName) => {
            document.getElementById("room-code").textContent = room;
            host = receivedHost;
            isHost = localStorage.getItem("userId") === host;
            started = isStarted;
            game = selectedGame;
            minPlayers = min;
            maxPlayers = max;
            if (!started) showSelectedGame(game, minPlayers, maxPlayers, gameName);
            updatePlayerList(players);
        });

        socket.on("request-user-id", () => {
            const storedId = localStorage.getItem("userId") || null;
            socket.emit("send-user-id", storedId);
        });

        socket.on("request-nickname", () => {
            const nicknamePopup = document.getElementById("nickname-popup");
            nicknamePopup.classList.remove("hidden");
            document.getElementById("nickname").focus();
        });

        function checkName() {
            let name = document.getElementById('nickname').value;

            if (name.length < 3) {
                nicknameReply("Minimum nickanme length is 3");
                return;
            } else if (name.length > 16) {
                nicknameReply("Maximum nickanme length is 16");
                return;
            }

            submitName(name);
        }

        function submitName(name) {
            // name, isInGame
            socket.emit("submit-name", name, true);

            const nicknameForm = document.getElementById('nickname-popup');
            nicknameForm.classList.add("hidden");
        }

        function nicknameReply(message) {
            let reply = document.getElementById("nickname-input-reply");
            reply.classList.remove("hidden");
            reply.innerHTML = message;
        }

        socket.on("player-joined", (player) => {
            showToast(`${player} joined.`);
            sendSystemMessage(`${player} joined the game.`);
        });

        socket.on("player-left", (player) => {
            showToast(`${player} left.`);
            sendSystemMessage(`${player} left the game.`);
        });

        socket.on("player-kicked", (player) => {
            showToast(`${player} got kicked.`);
            sendSystemMessage(`${player} got kicked.`);
        });

        socket.on("you-got-kicked", () => {
            alert("You got kicked from the room.");
            window.location.href = "/index.html";
        });

        socket.on("player-list", (players) => {
            updatePlayerList(players);
        });

        socket.on("chat-message", (message, name) => {
            const messageBox = document.getElementById("message-box");
            const messageDiv = document.createElement("div");
            messageDiv.classList.add(
                "p-2", 
                "bg-gray-200", 
                "rounded-lg", 
                "mb-2", 
                "text-gray-800",
                "w-full",         // Ensure it takes full width of its parent
                "max-w-xs",       // Limit maximum width to prevent horizontal growth
                "break-words",    // Break long words to prevent overflow
                "overflow-hidden" // Hide any overflow content
                );
            messageDiv.innerHTML = `<strong>${name}:</strong> ${message}`;
            messageBox.appendChild(messageDiv);
            messageBox.scrollTop = messageBox.scrollHeight; // Scroll to the bottom
            if (!isDrawerOpen()) document.getElementById("notification-badge").classList.remove("hidden");
        });

        socket.on("system-message", (message) => {
            sendSystemMessage(message);
        });

        function sendSystemMessage(message) {
            const messageBox = document.getElementById("message-box");
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("p-2", "bg-gray-300", "rounded-lg", "mb-2", "text-gray-800");
            messageDiv.innerHTML = `<em>${message}</em>`;
            messageBox.appendChild(messageDiv);
            messageBox.scrollTop = messageBox.scrollHeight; // Scroll to the bottom
        }

        function sendChatMessage() {
            const chatInput = document.getElementById("chat-input");
            let message = chatInput.value.trim();
            if (message.length > 200) {
                showToast("Message too long. Max 200 characters.");
                message = message.substring(0, 200); // Trim to 200 characters
            }
            if (message) {
                socket.emit("chat-message", message);
                chatInput.value = ""; // Clear the input field
            }
        }

        function openPopup(id) {
            document.getElementById(id).classList.remove('hidden');
        }
        function closePopup(id, event) {
            if (!event || event.target.id === id) {
                document.getElementById(id).classList.add('hidden');
            }
        }

        function updatePlayerList(players) {
            const playersDiv = document.getElementById("players");
            playersDiv.innerHTML = "";
            const lobbyPlayersDiv = document.getElementById("lobby-players");
            lobbyPlayersDiv.innerHTML = "";
            players.forEach(player => {
                for (let name in player) {
                    let userId = player[name];
                    const li = document.createElement("div");
                    li.classList.add(
                        "flex", "justify-between", "items-center", "p-3", "m-2", 
                        "bg-blue-600", "hover:bg-blue-700", "text-white", 
                        "rounded-lg", "shadow-md", "transition", "duration-200"
                    );
                    
                    if (userId === host) {
                        //without crown
                        li.innerHTML = `
                        <span class="text-lg font-medium">${name}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                    <path d="M19.6872 14.0931L19.8706 12.3884C19.9684 11.4789 20.033 10.8783 19.9823 10.4999L20 10.5C20.8284 10.5 21.5 9.82843 21.5 9C21.5 8.17157 20.8284 7.5 20 7.5C19.1716 7.5 18.5 8.17157 18.5 9C18.5 9.37466 18.6374 9.71724 18.8645 9.98013C18.5384 10.1814 18.1122 10.606 17.4705 11.2451L17.4705 11.2451C16.9762 11.7375 16.729 11.9837 16.4533 12.0219C16.3005 12.043 16.1449 12.0213 16.0038 11.9592C15.7492 11.847 15.5794 11.5427 15.2399 10.934L13.4505 7.7254C13.241 7.34987 13.0657 7.03557 12.9077 6.78265C13.556 6.45187 14 5.77778 14 5C14 3.89543 13.1046 3 12 3C10.8954 3 10 3.89543 10 5C10 5.77778 10.444 6.45187 11.0923 6.78265C10.9343 7.03559 10.759 7.34984 10.5495 7.7254L8.76006 10.934C8.42056 11.5427 8.25081 11.847 7.99621 11.9592C7.85514 12.0213 7.69947 12.043 7.5467 12.0219C7.27097 11.9837 7.02381 11.7375 6.5295 11.2451C5.88787 10.606 5.46156 10.1814 5.13553 9.98012C5.36264 9.71724 5.5 9.37466 5.5 9C5.5 8.17157 4.82843 7.5 4 7.5C3.17157 7.5 2.5 8.17157 2.5 9C2.5 9.82843 3.17157 10.5 4 10.5L4.01771 10.4999C3.96702 10.8783 4.03162 11.4789 4.12945 12.3884L4.3128 14.0931C4.41458 15.0393 4.49921 15.9396 4.60287 16.75H19.3971C19.5008 15.9396 19.5854 15.0393 19.6872 14.0931Z" fill="#f9ae19"/>
                                    <path d="M10.9121 21H13.0879C15.9239 21 17.3418 21 18.2879 20.1532C18.7009 19.7835 18.9623 19.1172 19.151 18.25H4.84896C5.03765 19.1172 5.29913 19.7835 5.71208 20.1532C6.65817 21 8.07613 21 10.9121 21Z" fill="#f9ae19"/>
                                </svg>`;
                    } else if (isHost) {
                        //with kick button
                        li.innerHTML = `
                        <span class="text-lg font-medium">${name}</span>
                        <button onclick="kickPlayerPopup('${userId}, ${name}')" class="p-2 rounded-md border border-gray-300 bg-transparent text-gray-300 hover:bg-red-400 hover:text-gray-900 transition duration-200">
                            <svg class="w-4 h-4 text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                            </svg>
                        </button>`;
                    } else {
                        //without kick button
                        li.innerHTML = `<span class="text-lg font-medium">${name}</span>`;
                    }
                    

                    playersDiv.appendChild(li);

                    const li2 = document.createElement("div");
                    li2.id = `lobby-player-${userId}`;
                    li2.classList.add(
                        "flex", "justify-between", "items-center", "p-3", "m-2",
                        "bg-transparent", "border-2", "border-gray-700", "h-10",
                        "hover:bg-gray-600", "transition-all", "duration-200", 
                        "rounded-md");

                    li2.innerHTML = `
                    <span class="text-lg text-white font-medium">${name}</span>
                    <div id='lobby-player-ready-state-${userId}' class="text-red-600">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>    
                    </div>
                    `;

                    lobbyPlayersDiv.appendChild(li2);
                }
            });
        }

        function kickPlayer(userId) {
            socket.emit("kick-player", userId);
        }

        socket.on("game-selected", (game, minPlayers, maxPlayers) => {
            showSelectedGame(game, minPlayers, maxPlayers);
        });

        function showSelectedGame(game, minPlayers, maxPlayers, gameName) {
            const gamesGrid = document.getElementById("games");
            for (let i = 0; i < gamesGrid.children.length; i++) {
                const gameButton = gamesGrid.children[i];
                if (gameButton.id === `game-${game}`) {
                    gameButton.classList.add("border-green-700");
                    gameButton.classList.remove("border-gray-700");
                } else {
                    gameButton.classList.add("border-gray-700");
                    gameButton.classList.remove("border-green-700");
                }
            }
            const gamesLabel = document.getElementById("games-label");
            gamesLabel.innerHTML = gameName ? `${gameName} (${minPlayers}-${maxPlayers} players)` : "Games";
            const readyButton = document.getElementById("ready-button");
            readyButton.classList.add("animation-pulse");
        }

        function selectGame(game) {
            if (!isHost) return;
            socket.emit("select-game", game);
        }

        function toggleReady(button) {
            socket.emit("toggle-ready");
            button.disabled = true;
            button.classList.remove("animation-pulse", "wbg-not-ready");
            button.classList.add("cursor-not-allowed");
            button.innerHTML = `<svg aria-hidden="true" class="w-8 h-8 text-gray-600 animate-spin fill-blue-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>
                                    <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>
                                </svg>`;
        }

        socket.on("ready-state", (userId, isReady) => {
            const playerDiv = document.getElementById("lobby-player-" + userId);
            const readyStateDiv = document.getElementById("lobby-player-ready-state-" + userId);
            if (isReady) {
                playerDiv.classList.add("border-green-700");
                playerDiv.classList.remove("border-gray-700");
                readyStateDiv.classList.remove("text-red-600");
                readyStateDiv.classList.add("text-green-600");
                readyStateDiv.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                            </svg>`;
            } else {
                playerDiv.classList.remove("border-green-700");
                playerDiv.classList.add("border-gray-700");
                readyStateDiv.classList.add("text-red-600");
                readyStateDiv.classList.remove("text-green-600");
                readyStateDiv.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                            </svg>`;
            }

            const readyButton = document.getElementById("ready-button");
            readyButton.classList.remove("cursor-not-allowed");
            readyButton.disabled = false;
            if (userId === localStorage.getItem("userId")) {
                if (isReady) {
                    readyButton.classList.add("wbg-ready");
                    readyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                                            </svg>`;
                } else {
                    readyButton.classList.add("animation-pulse", "wbg-not-ready");
                    readyButton.innerHTML = `<span class="text-white text-lg">Ready</span>`;
                }
            }
        });

        // Toast system
        let toastCounter = 0;
        const maxToasts = 5;

        function showToast(text) {
            if (toastCounter >= maxToasts) {
                // Remove the oldest toast to make space for new ones
                document.querySelector('#toast-container').children[0].remove();
            }

            const toast = document.createElement('div');
            
            toast.className = 'flex items-center w-full max-w-xs p-4 space-x-4 rtl:space-x-reverse divide-x rtl:divide-x-reverse divide-gray-200 rounded-lg shadow-sm text-gray-400 divide-gray-700 bg-gray-800 ps-4 text-sm font-normal transition all -translate-x-10';
            toast.innerText = text;

            const toastContainer = document.getElementById('toast-container');
            toastContainer.appendChild(toast);

            // Animate the toast
            setTimeout(() => {
                toast.classList.remove('opacity-0');
                toast.classList.add('opacity-100', 'translate-y-0', 'translate-x-0');
            }, 50);

            toastCounter++;

            // Automatically fade out after a few seconds
            setTimeout(() => {
                toast.classList.add('opacity-0', '-translate-y-5');
                setTimeout(() => {
                    toast.remove();
                    toastCounter--;
                }, 500); // Remove after fade
            }, 4000); // 4 seconds before fading out
        }

        function copyRoomCode() {
            const roomCode = document.getElementById("room-code").textContent;
            navigator.clipboard.writeText(roomCode).then(() => {
                showToast("Room code copied to clipboard!");
            }).catch(err => {
                console.error("Failed to copy: ", err);
            });
        }

        //Drawer system
        document.addEventListener("DOMContentLoaded", function () {
        const drawer = document.getElementById("player-sidebar");
        const openButton = document.querySelector("[data-drawer-show='player-sidebar']");
        const closeButton = drawer.querySelector("[data-drawer-hide='player-sidebar']");
        const notificationBadge = document.getElementById("notification-badge");

        // Function to open the drawer
        function openDrawer() {
            drawer.classList.remove("translate-x-full");
            notificationBadge.classList.add("hidden");
        }

        // Function to close the drawer
        function closeDrawer() {
            drawer.classList.add("translate-x-full");
        }

        // Event listeners
        openButton.addEventListener("click", openDrawer);
        closeButton.addEventListener("click", closeDrawer);

        // Close the drawer when clicking outside of it
        document.addEventListener("click", function (event) {
            if (!drawer.contains(event.target) && !openButton.contains(event.target)) {
                closeDrawer();
            }});
        });

        function isDrawerOpen() {
            const drawer = document.getElementById("player-sidebar");
            return !drawer.classList.contains("translate-x-full");
        }

        function leaveRoomPopup() {
            const leavePopup = document.getElementById("leave-popup");
            leavePopup.classList.remove("hidden");
            document.getElementById("leave-room-cancel").focus();
        }

        function closeLeaveRoomPopup() {
            const leavePopup = document.getElementById("leave-popup");
            leavePopup.classList.add("hidden");
        }

        function leaveRoom() {
            socket.emit("leave-room");
            window.location.href = "/index.html";
        }

        function kickPlayerPopup(userId, name) {
            const kickPopup = document.getElementById("kick-popup");
            kickPopup.classList.remove("hidden");
            document.getElementById("kick-id").innerHTML = userId;
            document.getElementById("kick-name").innerHTML = userId;
        }

        function closeKickPopup() {
            const kickPopup = document.getElementById("kick-popup");
            kickPopup.classList.add("hidden");
        }

        socket.on("game-started", (game) => {
            startGame(game);
        });

        function startGame(game) {
            const lobbyPopup = document.getElementById("lobby-popup");
            lobbyPopup.classList.add("hidden");

            loadGameHTML(game);
        }
    </script>

    <script type="module">
        async function loadGameHTML(game) {
            const res = await fetch(`/games/${game}.html`);
            const html = await res.text();
            document.getElementById('game-board').innerHTML = html;

            // After injecting the HTML, load the script manually
            const script = document.createElement('script');
            script.type = 'module';
            script.src = '/games/rock-paper-scissors.js';
            document.body.appendChild(script);
        }
    </script>
</body>
</html>