<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tile Game - Play</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        body {background-color: #2e298d; }
    </style>
</head>
<body class="flex items-center justify-center h-screen">
    
    <!-- Game Board -->
    <div id="game-board" class="w-full h-full absolute top-0 left-0"></div>
    
    <!-- Settings Popup -->
    <div id="settings-popup" class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center" onclick="closePopup('settings-popup', event)">
        <div class="bg-white p-6 rounded-lg shadow-lg text-black relative" onclick="event.stopPropagation();">
            <button onclick="closePopup('settings-popup')" class="absolute top-2 right-2 text-gray-600 hover:text-red-500">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                  </svg>                  
            </button>
            <h2 class="text-xl font-bold">Settings</h2>
            <label class="inline-flex items-center me-5 cursor-pointer">
                <input type="checkbox" value="" class="sr-only peer" checked>
                <div class="relative w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600 dark:peer-checked:bg-green-600"></div>
                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Setting 1</span>
            </label>
        </div>
    </div>

    <!-- drawer component -->
    <div id="player-sidebar" class="fixed top-0 right-0 z-40 h-screen p-4 overflow-y-auto transition-transform translate-x-full bg-white w-80 dark:bg-gray-800" tabindex="-1" aria-labelledby="drawer-right-label">
        <!-- Players Section -->
        <div id="players-section" class="h-1/3 overflow-y-auto">
            <h5 id="drawer-right-label" class="inline-flex items-center mb-4 text-base font-semibold text-gray-500 dark:text-gray-400">Players</h5>
            <button type="button" data-drawer-hide="player-sidebar" aria-controls="player-sidebar" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 absolute top-2.5 end-2.5 inline-flex items-center justify-center dark:hover:bg-gray-600 dark:hover:text-white">
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                </svg>
                <span class="sr-only">Close menu</span>
            </button>
            <div id="players"></div>
        </div>
        
        <!-- <div class="font-medium border-t border-gray-200 dark:border-gray-700"></div> -->
        
        <!-- Chat Section -->
        <div id="chat-section" class="flex flex-col h-2/3">
            <h5 id="drawer-right-label-chat" class="inline-flex items-center mb-4 text-base font-semibold text-gray-500 dark:text-gray-400">Chat</h5>
            <div id="message-box" class="flex-grow p-2 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700"></div>
            <div class="flex items-center mt-2">
                <input id="chat-input" type="text" placeholder="Type a message..." class="flex-grow p-2 border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-700 text-gray-900 dark:text-white" onkeydown="if (event.keyCode == 13) sendChatMessage()">
                <button id="send-btn" class="ml-2 p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" onclick="sendChatMessage()">Send</button>
            </div>
        </div>
    </div>
    
    <!-- UI Controls -->
    <div class="fixed top-4 right-4 space-x-4 flex">
        <!-- Server Status Icon -->
        <div class="relative">
            <button class="text-white text-2xl" onclick="showToast(`click ${Date.now()}`)">
                <svg id="server-status-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-gray-500">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z" />
                </svg>
            </button>
        </div>

        <!-- Settings -->
        <button onclick="openPopup('settings-popup')" class="text-white text-2xl">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.398.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.506-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
              </svg>              
        </button>
        
        <!-- drawer init and toggle -->   
        <button class="text-white text-2xl" type="button" data-drawer-target="player-sidebar" data-drawer-show="player-sidebar" data-drawer-placement="right" aria-controls="player-sidebar">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
            </svg>       
        </button>
    
    </div>

    <!-- Toast -->
    <div id="toast-container" class="fixed top-0 left-0 z-50 p-4 space-y-2"></div>

    <script>
        const socket = io("http://localhost:3000");

        // Server connection status
        socket.on("connect", () => {
            document.getElementById("server-status-icon").classList.remove("text-gray-500");
            document.getElementById("server-status-icon").classList.add("text-green-500");
        });

        socket.on("disconnect", () => {
            document.getElementById("server-status-icon").classList.remove("text-green-500");
            document.getElementById("server-status-icon").classList.add("text-gray-500");
        });

        socket.on("player-joined", (player) => {
            showToast(`${player} joined.`);
        });

        socket.on("player-kicked", (player) => {
            showToast(`${player} kicked.`);
        });

        socket.on("player-list", (players) => {
            updatePlayerList(players);
        });

        socket.on("chat-message", (message, name) => {
            const messageBox = document.getElementById("message-box");
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("p-2", "bg-gray-200", "rounded-lg", "mb-2", "text-gray-800");
            messageDiv.innerHTML = `<strong>${name}:</strong> ${message}`;
            messageBox.appendChild(messageDiv);
            messageBox.scrollTop = messageBox.scrollHeight; // Scroll to the bottom
        });

        function sendChatMessage() {
            const chatInput = document.getElementById("chat-input");
            let message = chatInput.value.trim();
            if (message.length > 200) {
                showToast("Message too long. Max 200 characters.");
                message = message.substring(0, 200); // Trim to 200 characters
            }
            if (message !== "") {
                socket.emit("chat-message", message);
                chatInput.value = ""; // Clear the input field
            }
        }

        function openPopup(id) {
            document.getElementById(id).classList.remove('hidden');
        }
        function closePopup(id, event) {
            if (!event || event.target.id === id) {
                document.getElementById(id).classList.add('hidden');
            }
        }

        function updatePlayerList(players) {
            const playersDiv = document.getElementById("players");
            playersDiv.innerHTML = "";
            players.forEach(player => {
                const li = document.createElement("div");
                li.classList.add("flex", "justify-between", "items-center", "py-1", "bg-white-300", "text-gray-800", "rounded-lg");
                li.innerHTML = `<span>${player}</span> <button onclick="kickPlayer('${player}')" class="text-red-500 hover:text-red-700">x</button>`;
                playersDiv.appendChild(li);
            });
            playerCount.textContent = players.length;
        }

        function joinPlayer(player) {
            showToast(`${player} kicked.`);
        }

        function kickPlayer(player) {

            showToast(`${player} kicked.`);
        }

        // Toast system
        let toastCounter = 0;
        const maxToasts = 5;

        function showToast(text) {
            if (toastCounter >= maxToasts) {
                // Remove the oldest toast to make space for new ones
                document.querySelector('#toast-container').children[0].remove();
            }

            const toast = document.createElement('div');
            
            toast.className = 'flex items-center w-full max-w-xs p-4 space-x-4 rtl:space-x-reverse text-gray-500 bg-white divide-x rtl:divide-x-reverse divide-gray-200 rounded-lg shadow-sm dark:text-gray-400 dark:divide-gray-700 dark:bg-gray-800 ps-4 text-sm font-normal transition all -translate-x-10';
            toast.innerText = text;

            const toastContainer = document.getElementById('toast-container');
            toastContainer.appendChild(toast);

            // Animate the toast
            setTimeout(() => {
                toast.classList.remove('opacity-0');
                toast.classList.add('opacity-100', 'translate-y-0', 'translate-x-0');
            }, 50);

            toastCounter++;

            // Automatically fade out after a few seconds
            setTimeout(() => {
                toast.classList.add('opacity-0', '-translate-y-5');
                setTimeout(() => {
                    toast.remove();
                    toastCounter--;
                }, 500); // Remove after fade
            }, 4000); // 4 seconds before fading out
        }

        //Drawer system
        document.addEventListener("DOMContentLoaded", function () {
        const drawer = document.getElementById("player-sidebar");
        const openButton = document.querySelector("[data-drawer-show='player-sidebar']");
        const closeButton = drawer.querySelector("[data-drawer-hide='player-sidebar']");

        // Function to open the drawer
        function openDrawer() {
            drawer.classList.remove("translate-x-full");
        }

        // Function to close the drawer
        function closeDrawer() {
            drawer.classList.add("translate-x-full");
        }

        // Event listeners
        openButton.addEventListener("click", openDrawer);
        closeButton.addEventListener("click", closeDrawer);

        // Close the drawer when clicking outside of it
        document.addEventListener("click", function (event) {
            if (!drawer.contains(event.target) && !openButton.contains(event.target)) {
                closeDrawer();
            }});
        });
    </script>
</body>
</html>