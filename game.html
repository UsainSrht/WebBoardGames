<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tile Game - Play</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        body {background-color: #2e298d; }
    </style>
</head>
<body class="flex items-center justify-center h-screen">
    
    <!-- Game Board -->
    <div id="game-board" class="w-full h-full absolute top-0 left-0"></div>
    
    <!-- Settings Popup -->
    <div id="settings-popup" class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center" onclick="closePopup('settings-popup', event)">
        <div class="bg-white p-6 rounded-lg shadow-lg text-black relative" onclick="event.stopPropagation();">
            <button onclick="closePopup('settings-popup')" class="absolute top-2 right-2 text-gray-600 hover:text-red-500">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                  </svg>                  
            </button>
            <h2 class="text-xl font-bold">Settings</h2>
            <label class="inline-flex items-center me-5 cursor-pointer">
                <input type="checkbox" value="" class="sr-only peer" checked>
                <div class="relative w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600 dark:peer-checked:bg-green-600"></div>
                <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Setting 1</span>
            </label>
        </div>
    </div>

    <!-- drawer component -->
    <div id="drawer-right-example"
        class="fixed top-0 right-0 z-40 h-screen p-4 overflow-y-auto transition-transform translate-x-full bg-white w-80 dark:bg-gray-800"
        tabindex="-1" aria-labelledby="drawer-right-label">
        <h5 id="drawer-right-label"
            class="inline-flex items-center mb-4 text-base font-semibold text-gray-500 dark:text-gray-400"><svg
                class="w-4 h-4 me-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                viewBox="0 0 20 20">
                <path
                    d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z" />
            </svg>Right drawer</h5>
        <button type="button" data-drawer-hide="drawer-right-example" aria-controls="drawer-right-example"
            class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 absolute top-2.5 end-2.5 inline-flex items-center justify-center dark:hover:bg-gray-600 dark:hover:text-white">
            <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
            </svg>
            <span class="sr-only">Close menu</span>
        </button>
        <p class="mb-6 text-sm text-gray-500 dark:text-gray-400">Supercharge your hiring by taking advantage of our <a
                href="#" class="text-blue-600 underline font-medium dark:text-blue-500 hover:no-underline">limited-time
                sale</a> for Flowbite Docs + Job Board. Unlimited access to over 190K top-ranked candidates and the #1
            design job board.</p>
        <div class="grid grid-cols-2 gap-4">
            <a href="#"
                class="px-4 py-2 text-sm font-medium text-center text-gray-900 bg-white border border-gray-200 rounded-lg focus:outline-none hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">Learn
                more</a>
            <a href="#"
                class="inline-flex items-center px-4 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Get
                access <svg class="rtl:rotate-180 w-3.5 h-3.5 ms-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                    fill="none" viewBox="0 0 14 10">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M1 5h12m0 0L9 1m4 4L9 9" />
                </svg></a>
        </div>
    </div>
    
    <!-- UI Controls -->
    <div class="fixed top-4 right-4 space-x-4 flex">
        <!-- Server Status Icon -->
        <div class="relative">
            <button class="text-white text-2xl" onclick="showToast(`click ${Date.now()}`)">
                <svg id="server-status-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-gray-500">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z" />
                </svg>                  
                <span id="server-status" class="absolute -top-1 -right-2 bg-red-500 text-white text-xs px-0.05 py-0.01 rounded-full">✖</span>
            </button>
        </div>

        <!-- Settings -->
        <button onclick="openPopup('settings-popup')" class="text-white text-2xl">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.398.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.506-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
              </svg>              
        </button>
        
        <!-- drawer init and toggle -->   
        <button class="text-white text-2xl" type="button" data-drawer-target="drawer-right-example" data-drawer-show="drawer-right-example" data-drawer-placement="right" aria-controls="drawer-right-example">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
            </svg>       
        </button>
    
    </div>

    <!-- Toast -->
    <div id="toast-container" class="fixed top-0 left-0 z-50 p-4 space-y-2"></div>

    <script>
        const socket = io("http://localhost:3000");

        // Server connection status
        socket.on("connect", () => {
            document.getElementById("server-status-icon").classList.remove("text-gray-500");
            document.getElementById("server-status-icon").classList.add("text-green-500");
            document.getElementById("server-status").classList.remove("bg-red-500");
            document.getElementById("server-status").classList.add("bg-green-500");
            document.getElementById("server-status").textContent = "✓";
        });

        socket.on("disconnect", () => {
            document.getElementById("server-status-icon").classList.remove("text-green-500");
            document.getElementById("server-status-icon").classList.add("text-gray-500");
            document.getElementById("server-status").classList.remove("bg-green-500");
            document.getElementById("server-status").classList.add("bg-red-500");
            document.getElementById("server-status").textContent = "✖";
        });

        socket.on("player-joined", (player) => {
            showToast(`${player} joined.`);
            addPlayerList(player);
        });

        socket.on("player-kicked", (player) => {
            showToast(`${player} kicked.`);
            removePlayerList(player);
        });

        function openPopup(id) {
            document.getElementById(id).classList.remove('hidden');
        }
        function closePopup(id, event) {
            if (!event || event.target.id === id) {
                document.getElementById(id).classList.add('hidden');
            }
        }

        function toggleDropdown() {
            const dropdown = document.getElementById("player-dropdown");
            if (dropdown.classList.contains("hidden")) {
                dropdown.classList.remove("hidden");
            } else {
                dropdown.classList.add("hidden");
            }
        }

        function updatePlayerList(players) {
            const playerList = document.getElementById("player-list");
            const playerCount = document.getElementById("player-count");
            playerList.innerHTML = "";
            players.forEach(player => {
                const li = document.createElement("li");
                li.classList.add("flex", "justify-between", "items-center", "py-1");
                li.innerHTML = `<span>${player}</span> <button onclick="kickPlayer('${player}')" class="text-red-500 hover:text-red-700">x</button>`;
                playerList.appendChild(li);
            });
            playerCount.textContent = players.length;
        }

        function joinPlayer(player) {
            showToast(`${player} kicked.`);
        }

        function kickPlayer(player) {

            showToast(`${player} kicked.`);
        }

        // Toast system
        let toastCounter = 0;
        const maxToasts = 5;

        function showToast(text) {
            if (toastCounter >= maxToasts) {
                // Remove the oldest toast to make space for new ones
                document.querySelector('#toast-container').children[0].remove();
            }

            const toast = document.createElement('div');
            
            toast.className = 'flex items-center w-full max-w-xs p-4 space-x-4 rtl:space-x-reverse text-gray-500 bg-white divide-x rtl:divide-x-reverse divide-gray-200 rounded-lg shadow-sm dark:text-gray-400 dark:divide-gray-700 dark:bg-gray-800 ps-4 text-sm font-normal transition all -translate-x-10';
            toast.innerText = text;

            const toastContainer = document.getElementById('toast-container');
            toastContainer.appendChild(toast);

            // Animate the toast
            setTimeout(() => {
                toast.classList.remove('opacity-0');
                toast.classList.add('opacity-100', 'translate-y-0', 'translate-x-0');
            }, 50);

            toastCounter++;

            // Automatically fade out after a few seconds
            setTimeout(() => {
                toast.classList.add('opacity-0', '-translate-y-5');
                setTimeout(() => {
                    toast.remove();
                    toastCounter--;
                }, 500); // Remove after fade
            }, 4000); // 4 seconds before fading out
        }
    </script>
</body>
</html>